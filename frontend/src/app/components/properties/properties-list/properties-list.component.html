<div class="container">
  <div class="card-header">
    <h1>Gerenciamento de Propriedades</h1>
    <p-button
      label="Nova propriedade"
      icon="pi pi-plus"
      (onClick)="openNew()"
    ></p-button>
  </div>

  <!-- Filters -->
  <div class="grid mb-4">
    <div class="col-12 md:col-6">
        <input
          pInputText
          type="text"
          [(ngModel)]="filterCulture"
          (input)="loadProperties()"
          placeholder="Pesquisar por cultura"
          class="w-full"
        />
    </div>
    <div class="col-12 md:col-6">
      <p-inputNumber
        [(ngModel)]="filterMinArea"
        (onInput)="loadProperties()"
        placeholder="Área mínima (hectares)"
        [min]="0"
        suffix=" ha"
        class="w-full"
      ></p-inputNumber>
    </div>
  </div>

  <!-- Table -->
  <p-table
    [value]="properties"
    [loading]="loading"
    [paginator]="true"
    [rows]="10"
    [showCurrentPageReport]="true"
    currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} propriedades"
    [tableStyle]="{ 'min-width': '50rem' }"
  >
    <ng-template pTemplate="header">
      <tr>
        <th>Lead</th>
        <th>Cultura</th>
        <th>Área (ha)</th>
        <th>Prioidade</th>
        <th>Ações</th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-property>
      <tr>
        <td>{{ property.lead?.nome || '-' }}</td>
        <td>{{ property.culture }}</td>
        <td>{{ property.areaHectares | number : '1.2-2' }}</td>
        <td>
          <p-tag
            *ngIf="isPriority(property.areaHectares)"
            severity="warn"
            value="Prioridade"
            icon="pi pi-star"
          ></p-tag>
          <span *ngIf="!isPriority(property.areaHectares)">Normal</span>
        </td>
        <td>
          <p-button
            icon="pi pi-pencil"
            [rounded]="true"
            [text]="true"
            severity="info"
            (onClick)="editProperty(property)"
            pTooltip="Edit"
          ></p-button>
          <p-button
            icon="pi pi-trash"
            [rounded]="true"
            [text]="true"
            severity="danger"
            (onClick)="deleteProperty(property)"
            pTooltip="Delete"
          ></p-button>
        </td>
      </tr>
    </ng-template>
    <ng-template pTemplate="emptymessage">
      <tr>
        <td colspan="5" class="text-center">No properties found</td>
      </tr>
    </ng-template>
  </p-table>

  <!-- Form Dialog -->
  <p-dialog
    [(visible)]="displayDialog"
    [header]="
      selectedProperty ? 'Editar propriedade' : 'Nova propriedade'
    "
    [modal]="true"
    [style]="{ width: '50vw' }"
    [breakpoints]="{ '960px': '75vw', '640px': '90vw' }"
  >
    <app-property-form
      [property]="selectedProperty"
      (save)="onSave()"
      (cancel)="onCancel()"
    ></app-property-form>
  </p-dialog>

  <p-confirmDialog></p-confirmDialog>
  <p-toast></p-toast>
</div>


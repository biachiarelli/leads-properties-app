<div class="container">
  <div class="card-header">
    <h1>Propriedades Rurais</h1>
    <p-button
      label="Nova Propriedade"
      icon="pi pi-plus"
      (onClick)="openNew()"
    ></p-button>
  </div>

  <!-- Filtros -->
  <div class="grid mb-4">
    <div class="col-12 md:col-6">
        <input
          pInputText
          type="text"
          [(ngModel)]="filterCultura"
          (input)="loadProperties()"
          placeholder="Buscar por cultura"
          class="w-full"
        />
    </div>
    <div class="col-12 md:col-6">
      <p-inputNumber
        [(ngModel)]="filterAreaMinima"
        (onInput)="loadProperties()"
        placeholder="Área mínima (hectares)"
        [min]="0"
        suffix=" ha"
        class="w-full"
      ></p-inputNumber>
    </div>
  </div>

  <!-- Tabela -->
  <p-table
    [value]="properties"
    [loading]="loading"
    [paginator]="true"
    [rows]="10"
    [showCurrentPageReport]="true"
    currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} properties"
    [tableStyle]="{ 'min-width': '50rem' }"
  >
    <ng-template pTemplate="header">
      <tr>
        <th>Lead</th>
        <th>Cultura</th>
        <th>Área (ha)</th>
        <th>Prioridade</th>
        <th>Ações</th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-propriedade>
      <tr>
        <td>{{ propriedade.lead?.nome || '-' }}</td>
        <td>{{ propriedade.cultura }}</td>
        <td>{{ propriedade.areaHectares | number : '1.2-2' }}</td>
        <td>
          <p-tag
            *ngIf="isPriority(propriedade.areaHectares)"
            severity="warn"
            value="PRIORITÁRIA"
            icon="pi pi-star"
          ></p-tag>
          <span *ngIf="!isPriority(propriedade.areaHectares)">-</span>
        </td>
        <td>
          <p-button
            icon="pi pi-pencil"
            [rounded]="true"
            [text]="true"
            severity="info"
            (onClick)="editProperty(propriedade)"
            pTooltip="Editar"
          ></p-button>
          <p-button
            icon="pi pi-trash"
            [rounded]="true"
            [text]="true"
            severity="danger"
            (onClick)="deleteProperty(propriedade)"
            pTooltip="Excluir"
          ></p-button>
        </td>
      </tr>
    </ng-template>
    <ng-template pTemplate="emptymessage">
      <tr>
        <td colspan="5" class="text-center">Nenhuma propriedade encontrada</td>
      </tr>
    </ng-template>
  </p-table>

  <!-- Dialog de Formulário -->
  <p-dialog
    [(visible)]="displayDialog"
    [header]="
      selectedProperty ? 'Editar Propriedade' : 'Nova Propriedade'
    "
    [modal]="true"
    [style]="{ width: '50vw' }"
    [breakpoints]="{ '960px': '75vw', '640px': '90vw' }"
  >
    <app-property-form
      [propriedade]="selectedProperty"
      (save)="onSave()"
      (cancel)="onCancel()"
    ></app-property-form>
  </p-dialog>

  <p-confirmDialog></p-confirmDialog>
  <p-toast></p-toast>
</div>

